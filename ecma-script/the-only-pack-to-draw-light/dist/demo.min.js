!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.theonlypacktodrawlight=e():t.theonlypacktodrawlight=e()}(window,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(e){return t[e]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=24)}([function(t,e,n){"use strict";function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){o(t,e,n[e])})}return t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.r(e),n.d(e,"OPDrawLight",function(){return u});var i=n(1),c=n(9),u=r({},c.default,i.default)},function(t,e,n){"use strict";n.r(e);var r=n(2),o=n(6),i=n(7),c=n(8);e.default={cpu:{SDF:{Circle:r.Circle,Plane:o.Plane,Rect:i.Rect},render:c.render}}},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?l(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.r(e),n.d(e,"Circle",function(){return b});var y=n(3),p=n(5),b=function(t){function e(t,n,r){var i;return o(this,e),i=u(this,a(e).call(this,t)),i._center=n,i._radius=r,i.getSourceDistance=i.getSourceDistance.bind(l(l(i))),i}return f(e,t),c(e,[{key:"getSourceDistance",value:function(t){var e=this._center,n=this._radius,r=Object(p.subf2)(t,e);return Math.sqrt(r.x*r.x+r.y*r.y)-n}}]),e}(y.SDF)},function(t,e,n){"use strict";function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){u(t,e,n[e])})}return t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.r(e),n.d(e,"SDF",function(){return f});var a=n(4),f=function(){function t(e){var n=this;o(this,t),u(this,"_opQueue",[]),u(this,"union",function(t){if(t)return n._opQueue.push({t:"u",to:t}),n}),u(this,"intersect",function(t){if(t)return n._opQueue.push({t:"i",to:t}),n}),u(this,"subtract",function(t){if(t)return n._opQueue.push({t:"s",to:t}),n}),this._props=r({},e),this.getLightSource=this.getLightSource.bind(this)}return c(t,[{key:"getSourceDistance",value:function(t){return 0}},{key:"getLightSource",value:function(t){var e=r({},this._props,{sourceDistance:this.getSourceDistance(t)}),n=new a.LightSource;for(var o in e)n[o]=e[o];return n}}]),t}()},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.r(e),n.d(e,"LightSource",function(){return i});var i=function t(e){var n=this;if(r(this,t),o(this,"sourceDistance",0),o(this,"emissive",0),o(this,"reflectivity",0),o(this,"eta",0),o(this,"triray",!1),o(this,"union",function(e){return new t(n.sourceDistance<e.sourceDistance?n:e)}),o(this,"intersect",function(e){var r=new t(n.sourceDistance>e.sourceDistance?e:n);return r.sourceDistance=n.sourceDistance>e.sourceDistance?n.sourceDistance:e.sourceDistance,r}),o(this,"subtract",function(e){var r=new t(n);return r.sourceDistance=n.sourceDistance>-e.sourceDistance?n.sourceDistance:-e.sourceDistance,r}),"string"==typeof e){switch(e){case"humble":break;case"awesome":this.reflectivity=.5;break;case"badass":this.reflectivity=.8,this.refract=1.5;break;case"asdfasdfasdfasdfasdf":default:this.reflectivity=.8,this.triray=!0}}else e&&(this.sourceDistance=e.sourceDistance,this.emissive=e.emissive,this.reflectivity=e.reflectivity,this.eta=e.eta,this.triray=e.triray)}},function(t,e,n){"use strict";function r(t,e){return{x:t.x+e.x,y:t.y+e.y}}function o(t,e){return{x:t.x*e,y:t.y*e}}function i(t,e){return r(t,o(e,-1))}function c(t,e){return o(t,1/e)}n.r(e),n.d(e,"addf2",function(){return r}),n.d(e,"mulf2",function(){return o}),n.d(e,"subf2",function(){return i}),n.d(e,"divf2",function(){return c})},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?l(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.r(e),n.d(e,"Plane",function(){return p});var y=n(3),p=function(t){function e(t,n,r){var i;return o(this,e),i=u(this,a(e).call(this,t)),i._pxy=n,i._normal=r,i.getSourceDistance=i.getSourceDistance.bind(l(l(i))),i}return f(e,t),c(e,[{key:"getSourceDistance",value:function(t){var e=this._pxy,n=this._normal;return(t.x-e.x)*n.x+(t.y-e.y)*n.y}}]),e}(y.SDF)},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?l(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.r(e),n.d(e,"Rect",function(){return p});var y=n(3),p=function(t){function e(t,n,r,i){var c;return o(this,e),c=u(this,a(e).call(this,t)),c._center=n,c._theta=r,c._s=i,c.getSourceDistance=c.getSourceDistance.bind(l(l(c))),c}return f(e,t),c(e,[{key:"getSourceDistance",value:function(t){var e=this._center,n=this._theta,r=this._s,o=Math.cos(n),i=Math.sin(n),c=Math.abs((t.x-e.x)*o+(t.y-e.y)*i)-r.x,u=Math.abs((t.y-e.y)*o-(t.x-e.x)*i)-r.y,a=Math.max(c,0),f=Math.max(u,0);return Math.min(Math.max(c,u),0)+Math.sqrt(a*a+f*f)}}]),e}(y.SDF)},function(t,e,n){"use strict";function r(t,e){var n=e._opQueue,o=e.getLightSource(t);if(0===n.length)return o;var i=!0,c=!1,u=void 0;try{for(var a,f=n[Symbol.iterator]();!(i=(a=f.next()).done);i=!0){var s=a.value,l=s.t,y=s.to;switch(l){case"u":o=o.union(r(t,y));break;case"i":o=o.intersect(r(t,y));break;case"s":o=o.subtract(r(t,y))}}}catch(t){c=!0,u=t}finally{try{i||null==f.return||f.return()}finally{if(c)throw u}}return o}function o(t,e){return r(t,e)}function i(t,e){return{x:(o({x:t.x+h,y:t.y},e).sourceDistance-o({x:t.x-h,y:t.y},e).sourceDistance)*(.5/h),y:(o({x:t.x,y:t.y+h},e).sourceDistance-o({x:t.x,y:t.y-h},e).sourceDistance)*(.5/h)}}function c(t,e){var n=2*(t.x*e.x+t.y*e.y);return{x:t.x-n*e.x,y:t.y-n*e.y}}function u(t,e,n){var r=t.x*e.x+t.y*e.y,o=1-n*n*(1-r*r),i=n*r+Math.sqrt(o);return{x:n*t.x-i*e.x,y:n*t.y-i*e.y}}function a(t,e,n,r){for(var f=0,s=o(t,n).sourceDistance>0?1:-1,y=0;y<p&&f<b;y++){var d=Object(l.addf2)(Object(l.mulf2)(e,f),t),m=o(d,n);if(m.sourceDistance*=s,m.sourceDistance<h){var g=m.emissive;if(r<3){var _=m.reflectivity;if(m.reflectivity>0||m.eta>0){var x=i(d,n);if(x=Object(l.mulf2)(x,s),m.eta>0){var S=u(e,x,s<0?m.eta:1/m.eta);g+=(1-_)*a(d-x*v,S,n,r+1)}if(_>0){var w=c(e,x);g+=_*a(d+x*v,w,n,r+1)}}}return g}f+=m.sourceDistance}return 0}function f(t,e){for(var n=0,r=0;r<y;r++){var o=2*Math.PI*(r+Math.random())/y;n+=a(t,{x:Math.cos(o),y:Math.sin(o)},e,0)}return n/64}function s(t,e){if(!t)throw new Error("canvas element not available.");var n=t.getContext("2d");if(!n)throw new Error("Canvas not supported on current browser.");for(var r=t.width,o=t.height,i=n.createImageData(r,o),c=0;c<o;c++)for(var u=0;u<r;u++){var a=c*r+u,s=Math.floor(255*f({x:1*u/r,y:1*c/o},e),0);i.data[4*a]=s,i.data[4*a+1]=s,i.data[4*a+2]=s,i.data[4*a+3]=255}n.putImageData(i,0,0)}n.r(e),n.d(e,"render",function(){return s});var l=n(5),y=32,p=10,b=4,h=1e-6,v=1e-4},function(t,e,n){"use strict";n.r(e);var r=n(10),o=n(20),i=n(22),c=n(23);e.default={gpu:{SDF:{Circle:i.Circle,Plane:c.Plane,Rect:o.Rect},render:r.render}}},function(t,e,n){"use strict";function r(t){return c(t)||i(t)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function i(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function c(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function u(t,e){if(!t)throw new Error("canvas element not available.");var n=t.getContext("webgl");if(!n)throw new Error("Webgl not supported on current browser.");var o=new Set;if(function t(e){if(e){o.add(e);var n=e._opQueue,r=!0,i=!1,c=void 0;try{for(var u,a=n[Symbol.iterator]();!(r=(u=a.next()).done);r=!0){var f=u.value,s=f.t,l=f.to;switch(s){case"u":case"i":case"s":t(l)}}}catch(t){i=!0,c=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw c}}}}(e),o=r(o),0!==o.length){var i=new a.Scene(n),c=function t(e){if(e){var n=e._opQueue,r=o.findIndex(function(t){return t===e});if(0===n.length)return"a".concat(r);var i=!0,c=!1,u=void 0;try{for(var a,f=n[Symbol.iterator]();!(i=(a=f.next()).done);i=!0){var s=a.value,l=s.t,y=s.to;switch(l){case"u":return"unionOp(a".concat(r,", ").concat(t(y),")");case"i":return"intersectOp(a".concat(r,", ").concat(t(y),")");case"s":return"subtractOp(a".concat(r,", ").concat(t(y),")")}}}catch(t){c=!0,u=t}finally{try{i||null==f.return||f.return()}finally{if(c)throw u}}}},u=o.map(function(t,e){return"LightSource a".concat(e," = ").concat(t.gpuDesc,";")}).join("\n"),y=u+"\nreturn ".concat(c(e),";"),p=i.createGlProgram(f.default,Object(s.default)(t.width,t.height,y),[l.VERT_POS]);i.bindProgram(p);var b=i.createVertices([-1,1,1,1,-1,-1,1,-1],2,[0,1,1,1,0,0,1,0],2);i.clear(),i.draw(b,"trianglestrip")}}n.r(e),n.d(e,"render",function(){return u});var a=n(11),f=n(18),s=n(19),l=n(13)},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?a(t):e}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.r(e),n.d(e,"Scene",function(){return v});var y=n(12),p=n(13),b=n(15),h=n(16),v=function(t){function e(t){return o(this,e),u(this,f(e).call(this,t))}return s(e,t),c(e,[{key:"createGlProgram",value:function(t,e,n,r){return new p.Program(this._gl,t,e,n,r)}},{key:"createVertices",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new h.VertexBuffer(this._gl,t,e,n,r)}},{key:"clear",value:function(){var t=this._gl;t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}},{key:"bindVertices",value:function(t){var e=this._gl,n=e.FLOAT,r=!1,o=0,i=0;e.bindBuffer(e.ARRAY_BUFFER,t.raw);var c=this._currentProgram.structure.attribLocations.get(p.VERT_POS);e.vertexAttribPointer(c,t.positionComponentCount,n,r,o,i),e.enableVertexAttribArray(c);var u=this._currentProgram.structure.attribLocations.get(p.VERT_TEX);null!==u&&void 0!==u&&(e.bindBuffer(e.ARRAY_BUFFER,t.texcoordBuffer),e.vertexAttribPointer(u,t.texcoordComponentCount,n,!0,o,i),e.enableVertexAttribArray(u))}},{key:"bindProgram",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._gl.useProgram(t.raw),this._currentProgram=t,e&&e.length>=2&&t.structure.uniformLocations.get(SHADER_TEXTURESIZE)&&this._gl.uniform2f(t.structure.uniformLocations.get(SHADER_TEXTURESIZE),e[0],e[1]),n)for(var o in n){var i=n[o],c=!1;"i"===o.charAt(0)&&(c=!0),t.structure.uniformLocations.get(o)&&("number"==typeof i?c?this._gl.uniform1i(t.structure.uniformLocations.get(o),i):this._gl.uniform1f(t.structure.uniformLocations.get(o),i):"object"===r(i)&&"[object Array]"===Object.prototype.toString.call(i)&&(c?this._gl.uniform1iv(t.structure.uniformLocations.get(o),new Int32Array(i)):this._gl.uniform1fv(t.structure.uniformLocations.get(o),new Float32Array(i))))}}},{key:"createFrameBuffer",value:function(t,e){return new FrameBuffer(this._gl,t,e)}},{key:"bindFrameBuffer",value:function(t){var e=this._gl;if(!t)return void e.bindFramebuffer(e.FRAMEBUFFER,null);t.use(),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"createTexture",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new b.Texture(this._gl,t,e)}},{key:"bindTexture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._gl;n.activeTexture(e===SAMPLER2?n.TEXTURE1:n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,t.raw),n.uniform1i(this._currentProgram.structure.uniformLocations.get(e||SAMPLER),e===SAMPLER2?1:0)}},{key:"draw",value:function(t,e){this.bindVertices(t);var n=this._gl,r=null;switch(e){case"line":r=n.LINES;break;case"linestrip":r=n.LINE_STRIP;break;case"triangle":r=n.TRIANGLES;break;case"trianglestrip":r=n.TRIANGLE_STRIP}n.drawArrays(r,0,t.vertexCount)}},{key:"getError",value:function(){return this._gl.getError()}}]),e}(y.GlBase)},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}n.r(e),n.d(e,"GlBase",function(){return c});var c=function(){function t(e){r(this,t),this._gl=e}return i(t,[{key:"context",get:function(){return this._gl}},{key:"raw",get:function(){return this._raw}}]),t}()},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?l(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.r(e),n.d(e,"VERT_POS",function(){return h}),n.d(e,"VERT_TEX",function(){return v}),n.d(e,"CAM_PROJ",function(){return d}),n.d(e,"CAM_MODEL",function(){return m}),n.d(e,"SAMPLER",function(){return g}),n.d(e,"SAMPLER2",function(){return _}),n.d(e,"SHADER_TEXTURESIZE",function(){return x}),n.d(e,"Program",function(){return S});var p=n(12),b=n(14),h="aVertexPosition",v="aTextureCoord",d="uProjectionMatrix",m="uModelViewMatrix",g="uSampler",_="uSampler2",x="uTextureSize",S=function(t){function e(t,n,r,i,c){var f;o(this,e),f=u(this,a(e).call(this,t)),y(l(l(f)),"_programStructure",null),f._vert=new b.Shader(t,"vert",n),f._frag=new b.Shader(t,"frag",r),f._raw=t.createProgram(),t.attachShader(f._raw,f._vert.raw),t.attachShader(f._raw,f._frag.raw),t.linkProgram(f._raw);var s=t;if(!s.getProgramParameter(f._raw,s.LINK_STATUS))throw"Unable to initialize the shader program: "+s.getProgramInfoLog(f._raw);return f._programStructure={attribLocations:(i||[]).reduce(function(t,e,n){return t.set(e,f._gl.getAttribLocation(f._raw,e)),t},new Map),uniformLocations:(c||[]).reduce(function(t,e,n){return t.set(e,f._gl.getUniformLocation(f._raw,e)),t},new Map)},f}return f(e,t),c(e,[{key:"use",value:function(){this._gl.useProgram(this.raw)}},{key:"structure",get:function(){return this._programStructure}}]),e}(p.GlBase)},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?a(t):e}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.r(e),n.d(e,"Shader",function(){return p});var y=n(12),p=function(t){function e(t,n,r){var i;return o(this,e),i=u(this,f(e).call(this,t)),i._type=n,i._source=r,i._raw=i._loadShader(),i}return s(e,t),c(e,[{key:"_loadShader",value:function(){var t=this._type,e=this._source,n=this.context,r=null;switch(t){case"vert":r=n.VERTEX_SHADER;break;case"frag":r=n.FRAGMENT_SHADER;break;default:throw new Error("Not supported.")}if(!r)throw new Error("Not supported.");var o=n.createShader(r);if(!o)throw new Error("shader failed.");if(n.shaderSource(o,e),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS)){var i=n.getShaderInfoLog(o);throw n.deleteShader(o),new Error("Shader compile failure: \n\n"+i)}return o}}]),e}(y.GlBase)},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?c(t):e}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.r(e),n.d(e,"Texture",function(){return l});var s=n(12),l=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;o(this,e),n=i(this,u(e).call(this,t)),n._width=r,n._height=c;var a=t;if(n._raw=a.createTexture(),!n._raw)throw"Texture create failure.";a.bindTexture(a.TEXTURE_2D,n._raw);var f=a.RGBA,s=a.RGBA,l=a.UNSIGNED_BYTE;return a.texImage2D(a.TEXTURE_2D,0,f,r,c,0,s,l,null),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),n}return a(e,t),e}(s.GlBase)},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?l(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.r(e),n.d(e,"VertexBuffer",function(){return b});var p=n(17),b=function(t){function e(t,n,r,i,c){var f;o(this,e),f=u(this,a(e).call(this,t)),y(l(l(f)),"_texBuffer",null);var s=t;return f._positionComponentCount=r,f._vertexCount=n.length/r,s.bindBuffer(s.ARRAY_BUFFER,f._raw),s.bufferData(s.ARRAY_BUFFER,new Float32Array(n),s.STATIC_DRAW),i&&(f._texBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,f._texBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(i),s.STATIC_DRAW),f._texcoordComponentCount=c),f}return f(e,t),c(e,[{key:"vertexCount",get:function(){return this._vertexCount}},{key:"positionComponentCount",get:function(){return this._positionComponentCount}},{key:"texcoordComponentCount",get:function(){return this._texcoordComponentCount}},{key:"texcoordBuffer",get:function(){return this._texBuffer}}]),e}(p.Buffer)},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?c(t):e}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.r(e),n.d(e,"Buffer",function(){return l});var s=n(12),l=function(t){function e(t){var n;return o(this,e),n=i(this,u(e).call(this,t)),n._raw=t.createBuffer(),n}return a(e,t),e}(s.GlBase)},function(t,e,n){"use strict";n.r(e),e.default="\nattribute vec4 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying highp vec2 vTextureCoord;\n\nvoid main() {\n    gl_Position = aVertexPosition;\n    vTextureCoord = aTextureCoord;\n}\n"},function(t,e,n){"use strict";n.r(e),e.default=function(t,e,n){return"\nprecision highp float;\n// uniform float sdfs[128];\n// uniform int iSdfOps[64];\n// uniform int iSdfCount; // sdf 数量\n\nconst float N = 64.0;\nconst int MAX_STEP = 64;\nconst float MAX_DISTANCE = 10.0;\nconst float EPSILON = 1e-6;\nconst float BIAS = 1e-4;\n\n\n// 定义一个光源\nstruct LightSource {\n    // 光源距离\n    float sourceDistance;\n    // 光(头)强\n    float emissive;\n    // 反射率\n    // 如果反射率超过 1，总能量就变多，不符合能量守恒。少于 1 代表形状吸收了能量。\n    float reflectivity;\n    // 介质折射率\n    // 如果光线从外至内，调用 \texttt{refract()} 时，传入 1 / eta ；从内至外则传入 eta 。\n    float eta;\n};\n\n\n// 合并两个LightSource\nLightSource unionOp(LightSource a, LightSource b) {\n  if(a.sourceDistance < b.sourceDistance) {\n    return a;\n  }\n  return b;\n}\n\nLightSource intersectOp(LightSource a, LightSource b) {\n    LightSource r = a;\n    if(a.sourceDistance > b.sourceDistance) {\n      r = b;\n    }\n    r.sourceDistance = a.sourceDistance > b.sourceDistance ? a.sourceDistance : b.sourceDistance;\n    return r;\n}\n\nLightSource subtractOp(LightSource a, LightSource b) {\n    LightSource r = a;\n    r.sourceDistance = (a.sourceDistance > -b.sourceDistance) ? a.sourceDistance : -b.sourceDistance;\n    return r;\n}\n\n\n// 一个圆形光源\nfloat circleSDF(vec2 xy, vec2 center, float radius) {\n    vec2 u = xy - center;\n    return sqrt(u.x * u.x + u.y * u.y) - radius;\n}\n\n// 抄这 https://zhuanlan.zhihu.com/p/30816284\nfloat boxSDF(vec2 xy, vec2 center, float theta, vec2 s) {\n    float costheta = cos(theta), sintheta = sin(theta);\n    float dx = abs((xy.x - center.x) * costheta + (xy.y - center.y) * sintheta) - s.x;\n    float dy = abs((xy.y - center.y) * costheta - (xy.x - center.x) * sintheta) - s.y;\n    float ax = max(dx, .0), ay = max(dy, .0 );\n    return min(max(dx, dy), .0) + sqrt(ax * ax + ay * ay);\n}\n\n// 抄这个 https://github.com/miloyip/light2d/blob/master/refraction.c\nfloat planeSDF(vec2 xy, vec2 pxy, vec2 normal) {\n    return (xy.x - pxy.x) * normal.x + (xy.y - pxy.y) * normal.y;\n}\n\nLightSource createLS(float sd, float emissive, float reflectivity, float eta) {\n  LightSource ret;\n  ret.sourceDistance = sd;\n  ret.emissive = emissive;\n  ret.reflectivity = reflectivity;\n  ret.eta = eta;\n  return ret;\n}\n\nLightSource scene(vec2 xy) {\n  ".concat(n,";\n}\n\n// 说是计算法线\nvec2 gradient(vec2 xy) {\n  vec2 xy00 = vec2(xy.x + EPSILON, xy.y);\n  vec2 xy01 = vec2(xy.x - EPSILON, xy.y);\n  vec2 xy10 = vec2(xy.x, xy.y + EPSILON);\n  vec2 xy11 = vec2(xy.x, xy.y - EPSILON);\n  float hEp = 0.5 / EPSILON;\n  return vec2((scene(xy00).sourceDistance - scene(xy01).sourceDistance) * hEp,\n              (scene(xy10).sourceDistance - scene(xy11).sourceDistance) * hEp);\n}\n\n// /**\n// * 折射函数\n// * @param {*} ixy\n// * @param {*} nxy\n// */\n// vec2 reflect(vec2 ixy, vec2 nxy) {\n//   float idotn2 = (ixy.x * nxy.x + ixy.y * nxy.y) * 2.0;\n//   return vec2(ixy.x - idotn2 * nxy.x,\n//       ixy.y - idotn2 * nxy.y);\n// }\n\n// /**\n// * 折射函数\n// * @param {*} ixy\n// * @param {*} nxy\n// * @param {*} eta\n// */\n// vec2 refract(vec2 ixy, vec2 nxy, float eta) {\n//   float idotn = ixy.x * nxy.x + ixy.y * nxy.y;\n//   float k = 1.0 - eta * eta * (1.0 - idotn * idotn);\n//   float a = eta * idotn + sqrt(k);\n//   return vec2(eta * ixy.x - a * nxy.x,\n//       eta * ixy.y - a * nxy.y);\n// }\n\n\n/**\n* ray tracing\n* @param {*} o\n* @param {*} d\n* @param {*} depth\n*/\nfloat trace0(vec2 o, vec2 d) {\n  float t = .0;\n  // 判断是场景内还是外，间eta注释\n  float s = scene(o).sourceDistance > .0 ? 1.0 : -1.0;\n  for (int i = 0; i < MAX_STEP; i++) {\n    if(t >= MAX_DISTANCE) { break; }\n    vec2 xy = d * t + o;\n    LightSource sd = scene(xy);\n    sd.sourceDistance = sd.sourceDistance * s;\n    if (sd.sourceDistance < EPSILON) {\n        // 反射\n        return sd.emissive;\n    }\n    t += sd.sourceDistance;\n  }\n  return .0;\n}\n\n/**\n* ray tracing\n* @param {*} o\n* @param {*} d\n* @param {*} depth\n*/\nfloat trace1(vec2 o, vec2 d) {\n  float t = .0;\n  // 判断是场景内还是外，间eta注释\n  float s = scene(o).sourceDistance > .0 ? 1.0 : -1.0;\n  for (int i = 0; i < MAX_STEP; i++) {\n    if(t >= MAX_DISTANCE) { break; }\n    vec2 xy = d * t + o;\n    LightSource sd = scene(xy);\n    sd.sourceDistance = sd.sourceDistance * s;\n    if (sd.sourceDistance < EPSILON) {\n        // 反射\n        float sum = sd.emissive;\n        float refl = sd.reflectivity;\n        if (sd.reflectivity > .0 || sd.eta > .0) {\n            vec2 normal = gradient(xy);\n            normal = normal * s;// 在内的话，要反转法线\n            normal = normalize(normal);\n            if (sd.eta > .0) {\n                vec2 etaRange = refract(d, normal, s < .0 ? sd.eta : 1.0 / sd.eta);\n                sum += (1.0 - refl) * trace0(xy - normal * BIAS, etaRange);\n            }\n            if (refl > .0) {\n                vec2 refl2 = reflect(d, normal);\n                sum += refl * trace0(xy + normal * BIAS, refl2);\n            }\n        }\n        return sum;\n    }\n    t += sd.sourceDistance;\n  }\n  return .0;\n}\n\n/**\n* ray tracing\n* @param {*} o\n* @param {*} d\n* @param {*} depth\n*/\nfloat trace2(vec2 o, vec2 d) {\n  float t = .0;\n  // 判断是场景内还是外，间eta注释\n  float s = scene(o).sourceDistance > .0 ? 1.0 : -1.0;\n  for (int i = 0; i < MAX_STEP; i++) {\n    if(t >= MAX_DISTANCE) { break; }\n    vec2 xy = d * t + o;\n    LightSource sd = scene(xy);\n    sd.sourceDistance = sd.sourceDistance * s;\n    if (sd.sourceDistance < EPSILON) {\n        // 反射\n        float sum = sd.emissive;\n        float refl = sd.reflectivity;\n        if (sd.reflectivity > .0 || sd.eta > .0) {\n            vec2 normal = gradient(xy);\n            normal = normal * s;// 在内的话，要反转法线\n            normal = normalize(normal);\n            if (sd.eta > .0) {\n                vec2 etaRange = refract(d, normal, s < .0 ? sd.eta : 1.0 / sd.eta);\n                sum += (1.0 - refl) * trace1(xy - normal * BIAS, etaRange);\n            }\n            if (refl > .0) {\n                vec2 refl2 = reflect(d, normal);\n                sum += refl * trace1(xy + normal * BIAS, refl2);\n            }\n        }\n        return sum;\n    }\n    t += sd.sourceDistance;\n  }\n  return .0;\n}\n\n/**\n* ray tracing\n* @param {*} o\n* @param {*} d\n* @param {*} depth\n*/\nfloat trace(vec2 o, vec2 d) {\n  float t = .0;\n  // 判断是场景内还是外，间eta注释\n  float s = scene(o).sourceDistance > .0 ? 1.0 : -1.0;\n  for (int i = 0; i < MAX_STEP; i++) {\n    if(t >= MAX_DISTANCE) { break; }\n    vec2 xy = d * t + o;\n    LightSource sd = scene(xy);\n    sd.sourceDistance = sd.sourceDistance * s;\n    if (sd.sourceDistance < EPSILON) {\n        // 反射\n        float sum = sd.emissive;\n        float refl = sd.reflectivity;\n        if (sd.reflectivity > .0 || sd.eta > .0) {\n            vec2 normal = gradient(xy);\n            normal = normal * s;// 在内的话，要反转法线\n            normal = normalize(normal);\n            if (sd.eta > .0) {\n                vec2 etaRange = refract(d, normal, s < .0 ? sd.eta : 1.0 / sd.eta);\n                sum += (1.0 - refl) * trace2(xy - normal * BIAS, etaRange);\n            }\n            if (refl > .0) {\n                vec2 refl2 = reflect(d, normal);\n                sum += refl * trace2(xy + normal * BIAS, refl2);\n            }\n        }\n        return sum;\n    }\n    t += sd.sourceDistance;\n  }\n  return .0;\n}\n\n// 随机数\n// 从这抄的： https://thebookofshaders.com/10/\nfloat rand (vec2 st) {\n    return fract(sin(dot(st,\n                         vec2(12.9898, 78.233)))*\n                 43758.5453123);\n}\n\n\n/**\n* 采样(x,y)的颜色\n* jitter sampling.\n* @param {*} xy x,y像素点\n*/\nfloat sample(vec2 xy) {\n  float sum = .0;\n  for (float i = .0; i < N; i += 1.0) {\n      float a = 6.2831852 * (i + rand(xy)) / N;\n      sum += trace(xy, vec2(cos(a), sin(a)));\n  }\n  return sum / N;\n}\n\nvoid main(void) {\n  float width = ").concat(parseInt(t,10),".0;\n  float height = ").concat(parseInt(e,10),".0;\n  vec2 xy = vec2(gl_FragCoord.x / width, 1.0 - gl_FragCoord.y / height);\n  float gray = sample(xy);\n  gl_FragColor = vec4(gray, gray, gray, 1);\n}\n")}},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?a(t):e}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.r(e),n.d(e,"Rect",function(){return p});var y=n(21),p=function(t){function e(t,n,r,i){var c;return o(this,e),c=u(this,f(e).call(this,t)),c._center=n,c._theta=r,c._s=i,c}return s(e,t),c(e,[{key:"gpuDesc",get:function(){var t=this._props;t=void 0===t?{}:t;var e=t.emissive,n=void 0===e?0:e,r=t.reflectivity,o=void 0===r?0:r,i=t.eta,c=void 0===i?0:i,u=this._center;u=void 0===u?{}:u;var a=u.x,f=u.y,s=this._s,l=s.x,y=s.y,p=this._theta;return"createLS(boxSDF(xy, vec2(".concat(this.floatize(a),", ").concat(this.floatize(f),"), ").concat(this.floatize(p),", vec2(").concat(this.floatize(l),", ").concat(this.floatize(y),")), ").concat(this.floatize(n),", ").concat(this.floatize(o),", ").concat(this.floatize(c),")")}}]),e}(y.SDF)},function(t,e,n){"use strict";function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){u(t,e,n[e])})}return t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.r(e),n.d(e,"SDF",function(){return a});var a=function(){function t(e){var n=this;o(this,t),u(this,"_opQueue",[]),u(this,"floatize",function(t){var e=t+"";return e.indexOf(".")>=0?e:e+".0"}),u(this,"union",function(t){if(t)return n._opQueue.push({t:"u",to:t}),n}),u(this,"intersect",function(t){if(t)return n._opQueue.push({t:"i",to:t}),n}),u(this,"subtract",function(t){if(t)return n._opQueue.push({t:"s",to:t}),n}),this._props=r({},e)}return c(t,[{key:"gpuDesc",get:function(){return null}}]),t}()},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?a(t):e}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.r(e),n.d(e,"Circle",function(){return p});var y=n(21),p=function(t){function e(t,n,r){var i;return o(this,e),i=u(this,f(e).call(this,t)),i._center=n,i._radius=r,i}return s(e,t),c(e,[{key:"gpuDesc",get:function(){var t=this._props;t=void 0===t?{}:t;var e=t.emissive,n=void 0===e?0:e,r=t.reflectivity,o=void 0===r?0:r,i=t.eta,c=void 0===i?0:i,u=this._center;u=void 0===u?{}:u;var a=u.x,f=u.y,s=this._radius;return"createLS(circleSDF(xy, vec2(".concat(this.floatize(a),", ").concat(this.floatize(f),"), ").concat(this.floatize(s),"), ").concat(this.floatize(n),", ").concat(this.floatize(o),", ").concat(this.floatize(c),")")}}]),e}(y.SDF)},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?a(t):e}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.r(e),n.d(e,"Plane",function(){return p});var y=n(21),p=function(t){function e(t,n,r){var i;return o(this,e),i=u(this,f(e).call(this,t)),i._pxy=n,i._normal=r,i}return s(e,t),c(e,[{key:"gpuDesc",get:function(){var t=this._props;t=void 0===t?{}:t;var e=t.emissive,n=void 0===e?0:e,r=t.reflectivity,o=void 0===r?0:r,i=t.eta,c=void 0===i?0:i,u=this._pxy;u=void 0===u?{}:u;var a=u.x,f=u.y,s=this._normal;s=void 0===s?{}:s;var l=s.x,y=s.y;return"createLS(planeSDF(xy, vec2(".concat(this.floatize(a),", ").concat(this.floatize(f),"), vec2(").concat(this.floatize(l),", ").concat(this.floatize(y),")), ").concat(this.floatize(n),", ").concat(this.floatize(o),", ").concat(this.floatize(c),")")}}]),e}(y.SDF)},function(t,e,n){"use strict";n.r(e);var r=n(0),o=r.OPDrawLight.gpu,i=o.SDF,c=i.Circle,u=i.Plane,a=o.render,f=new c({emissive:20,reflectivity:0,eta:0},{x:.5,y:-.5},.05),s=new c({emissive:0,reflectivity:.2,eta:1.5},{x:.5,y:.5},.2),l=new u({emissive:0,reflectivity:.2,eta:1.45},{x:.5,y:.5},{x:0,y:-1});a(document.getElementById("cv"),f.union(s.intersect(l)))}])});